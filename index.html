<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CZN Save Data Calculator - Team Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            padding: 8px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .header h1 {
            font-size: 20px;
            color: #bb86fc;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 10px;
            color: #999;
        }

        .controls-row {
            display: grid;
            grid-template-columns: 120px 100px auto;
            gap: 8px;
            margin-bottom: 8px;
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .control-group label {
            display: block;
            font-size: 9px;
            color: #aaa;
            margin-bottom: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 6px;
            background: #2a2a40;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
        }

        .btn-group {
            display: flex;
            gap: 6px;
            align-items: end;
        }

        .btn {
            padding: 6px 12px;
            background: #bb86fc;
            color: #1a1a2e;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn:hover {
            background: #d4b3ff;
            transform: translateY(-1px);
        }

        .btn.secondary {
            background: #6366f1;
        }

        .btn.export {
            background: #10b981;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .character-card {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .char-header {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #444;
        }

        .char-name-input {
            width: 100%;
            padding: 6px;
            background: #1a1a2e;
            border: 2px solid #bb86fc;
            border-radius: 4px;
            color: #bb86fc;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
        }

        .char-budget {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .char-budget-label {
            font-size: 9px;
            color: #aaa;
        }

        .char-budget-value {
            font-size: 14px;
            font-weight: bold;
        }

        .char-budget-value.ok {
            color: #4caf50;
        }

        .char-budget-value.over {
            color: #f44336;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #1a1a2e;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .progress-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .progress-fill.ok {
            background: linear-gradient(90deg, #4caf50 0%, #66bb6a 100%);
        }

        .progress-fill.over {
            background: linear-gradient(90deg, #f44336 0%, #e57373 100%);
        }

        .remaining-text {
            font-size: 9px;
            text-align: right;
            font-weight: 600;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 6px 8px;
            align-items: center;
        }

        .input-label {
            font-size: 10px;
            color: #aaa;
        }

        .input-field {
            width: 60px;
            padding: 5px;
            font-size: 11px;
            text-align: center;
            font-weight: 600;
        }

        .input-cost {
            font-size: 9px;
            color: #888;
            width: 45px;
            text-align: right;
        }

        .team-summary {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            margin-bottom: 8px;
        }

        .summary-title {
            font-size: 12px;
            color: #bb86fc;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .summary-item {
            text-align: center;
            background: #2a2a40;
            padding: 8px;
            border-radius: 4px;
        }

        .summary-label {
            font-size: 9px;
            color: #aaa;
            margin-bottom: 4px;
        }

        .summary-value {
            font-size: 16px;
            font-weight: bold;
            color: #bb86fc;
        }

        .info-section {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 8px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .info-title {
            font-size: 10px;
            color: #bb86fc;
            margin-bottom: 6px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            font-size: 9px;
            color: #aaa;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 2px 4px;
        }

        .info-value {
            color: #bb86fc;
            font-weight: 600;
        }

        .tour-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .tour-overlay.active {
            display: block;
        }

        .tour-spotlight {
            position: absolute;
            border: 3px solid #bb86fc;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .tour-tooltip {
            position: fixed;
            background: linear-gradient(135deg, #2a2a40 0%, #1f1f35 100%);
            border: 2px solid #bb86fc;
            border-radius: 12px;
            padding: 20px;
            max-width: 400px;
            width: calc(100% - 40px);
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1002;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .tour-tooltip h3 {
            color: #bb86fc;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .tour-tooltip p {
            color: #e0e0e0;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .tour-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tour-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .tour-btn.primary {
            background: #bb86fc;
            color: #1a1a2e;
        }

        .tour-btn.secondary {
            background: #444;
            color: #e0e0e0;
        }

        .tour-btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        .tour-progress {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-top: 10px;
        }

        .help-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #bb86fc;
            color: #1a1a2e;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(187, 134, 252, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .help-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(187, 134, 252, 0.6);
        }

        @media (max-width: 1200px) {
            .team-grid {
                grid-template-columns: 1fr;
            }
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .tour-tooltip {
                max-width: calc(100% - 40px);
                padding: 15px;
            }
            .tour-tooltip h3 {
                font-size: 16px;
            }
            .tour-tooltip p {
                font-size: 13px;
            }
        }

        @media (max-width: 600px) {
            .tour-tooltip {
                padding: 12px;
            }
            .tour-tooltip h3 {
                font-size: 14px;
                margin-bottom: 8px;
            }
            .tour-tooltip p {
                font-size: 12px;
                margin-bottom: 12px;
            }
            .tour-btn {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ CZN Team Save Data Calculator</h1>
            <p>Chaos Zero Nightmare - 3 Character Team Manager</p>
        </div>

        <div class="controls-row">
            <div class="control-group">
                <label>Tier Level</label>
                <select id="tier" onchange="updateTier()">
                    <option value="1">Tier 1 (30 FM)</option>
                    <option value="2">Tier 2 (40 FM)</option>
                    <option value="3">Tier 3 (50 FM)</option>
                    <option value="4">Tier 4 (60 FM)</option>
                    <option value="5">Tier 5 (70 FM)</option>
                    <option value="6">Tier 6 (80 FM)</option>
                    <option value="7">Tier 7 (90 FM)</option>
                    <option value="8">Tier 8 (100 FM)</option>
                    <option value="9">Tier 9 (110 FM)</option>
                    <option value="10">Tier 10 (120 FM)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Custom Max FM</label>
                <input type="number" id="customMax" value="30" min="0" onchange="calculate()">
            </div>

            <div class="btn-group">
                <button class="btn" onclick="resetAll()">Reset All</button>
                <button class="btn secondary" onclick="resetCounts()">Reset Counts</button>
                <button class="btn export" onclick="exportAsImage()">ðŸ“· Export JPG</button>
            </div>
        </div>

        <div class="team-summary">
            <div class="summary-title">ðŸ“Š Team Summary</div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Total FM Used</div>
                    <div class="summary-value" id="teamTotal">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">FM Limit</div>
                    <div class="summary-value" id="teamLimit">90</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">FM Remaining</div>
                    <div class="summary-value" id="teamRemaining">90</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Team Status</div>
                    <div class="summary-value" id="teamStatus">âœ“ OK</div>
                </div>
            </div>
        </div>

        <div class="team-grid" id="teamGrid"></div>

        <div class="info-section">
            <div class="info-title">ðŸ“‹ Faint Memory Costs</div>
            <div class="info-grid">
                <div class="info-item"><span>Neutral:</span><span class="info-value">20 FM</span></div>
                <div class="info-item"><span>Monster:</span><span class="info-value">80 FM</span></div>
                <div class="info-item"><span>Epiphany:</span><span class="info-value">+10 FM</span></div>
                <div class="info-item"><span>Divine Epi:</span><span class="info-value">20 FM</span></div>
                <div class="info-item"><span>Remove 2nd:</span><span class="info-value">10 FM</span></div>
                <div class="info-item"><span>Remove 3rd:</span><span class="info-value">30 FM</span></div>
                <div class="info-item"><span>Remove 4th:</span><span class="info-value">50 FM</span></div>
                <div class="info-item"><span>Remove 5th+:</span><span class="info-value">70 FM</span></div>
                <div class="info-item"><span>Dupe 2nd:</span><span class="info-value">10 FM</span></div>
                <div class="info-item"><span>Dupe 3rd:</span><span class="info-value">30 FM</span></div>
                <div class="info-item"><span>Dupe 4th:</span><span class="info-value">50 FM</span></div>
                <div class="info-item"><span>Dupe 5th+:</span><span class="info-value">70 FM</span></div>
                <div class="info-item"><span>Conversion:</span><span class="info-value">10 FM</span></div>
                <div class="info-item"><span>Forbidden:</span><span class="info-value">20 FM</span></div>
                <div class="info-item"><span>Start Mod:</span><span class="info-value">+20 FM</span></div>
                <div class="info-item"><span>Epi Mod:</span><span class="info-value">+20 FM</span></div>
            </div>
        </div>

        <button class="help-btn" onclick="startTour()" title="Start Tour">?</button>
    </div>

    <div class="tour-overlay" id="tourOverlay">
        <div class="tour-spotlight" id="tourSpotlight"></div>
        <div class="tour-tooltip" id="tourTooltip"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        var tierLimits = { 1: 30, 2: 40, 3: 50, 4: 60, 5: 70, 6: 80, 7: 90, 8: 100, 9: 110, 10: 120 };
        
        var fields = [
            { key: 'neutral', label: 'Neutral Cards', cost: 20 },
            { key: 'monster', label: 'Monster Cards', cost: 80 },
            { key: 'epiphany', label: 'Epiphany Modifier', cost: 10 },
            { key: 'divine', label: 'Divine Epiphanies', cost: 20 },
            { key: 'removal2', label: 'Card Removal (2nd)', cost: 10 },
            { key: 'removal3', label: 'Card Removal (3rd)', cost: 30 },
            { key: 'removal4', label: 'Card Removal (4th)', cost: 50 },
            { key: 'removal5', label: 'Card Removal (5th+)', cost: 70 },
            { key: 'dupe2', label: 'Card Duplication (2nd)', cost: 10 },
            { key: 'dupe3', label: 'Card Duplication (3rd)', cost: 30 },
            { key: 'dupe4', label: 'Card Duplication (4th)', cost: 50 },
            { key: 'dupe5', label: 'Card Duplication (5th+)', cost: 70 },
            { key: 'conversion', label: 'Card Conversions', cost: 10 },
            { key: 'forbidden', label: 'Forbidden Cards', cost: 20 },
            { key: 'starting', label: 'Starting Card Modifier', cost: 20 },
            { key: 'epiremoval', label: 'Epiphany Card Modifier', cost: 20 }
        ];

        function initTeam() {
            var grid = document.getElementById('teamGrid');
            grid.innerHTML = '';
            
            for (var i = 1; i <= 3; i++) {
                var card = document.createElement('div');
                card.className = 'character-card';
                
                var html = '<div class="char-header">' +
                    '<input type="text" class="char-name-input" id="char' + i + '-name" placeholder="Character ' + i + ' Name" onchange="calculate()">' +
                    '<div class="char-budget">' +
                    '<span class="char-budget-label">FM Usage</span>' +
                    '<span class="char-budget-value ok" id="char' + i + '-budget">0 / 30</span>' +
                    '</div>' +
                    '<div class="progress-bar">' +
                    '<div class="progress-fill ok" id="char' + i + '-progress" style="width: 0%"></div>' +
                    '</div>' +
                    '<div class="remaining-text ok" id="char' + i + '-remaining">30 FM remaining</div>' +
                    '</div>' +
                    '<div class="inputs-grid">';
                
                for (var j = 0; j < fields.length; j++) {
                    var field = fields[j];
                    html += '<span class="input-label">' + field.label + '</span>' +
                        '<input type="number" class="input-field" id="char' + i + '-' + field.key + '" value="0" min="0" onchange="calculate()">' +
                        '<span class="input-cost">' + field.cost + ' FM</span>';
                }
                
                html += '</div>';
                card.innerHTML = html;
                grid.appendChild(card);
            }
        }

        function calculate() {
            var maxCost = parseInt(document.getElementById('customMax').value) || 0;
            var teamTotal = 0;
            
            for (var i = 1; i <= 3; i++) {
                var charTotal = 0;
                
                for (var j = 0; j < fields.length; j++) {
                    var field = fields[j];
                    var count = parseInt(document.getElementById('char' + i + '-' + field.key).value) || 0;
                    charTotal += count * field.cost;
                }
                
                teamTotal += charTotal;
                
                var remaining = maxCost - charTotal;
                var isOver = remaining < 0;
                var percent = Math.min((charTotal / maxCost) * 100, 100);
                
                document.getElementById('char' + i + '-budget').textContent = charTotal + ' / ' + maxCost;
                document.getElementById('char' + i + '-budget').className = 'char-budget-value ' + (isOver ? 'over' : 'ok');
                
                var progress = document.getElementById('char' + i + '-progress');
                progress.style.width = percent + '%';
                progress.className = 'progress-fill ' + (isOver ? 'over' : 'ok');
                
                var remainingText = document.getElementById('char' + i + '-remaining');
                remainingText.textContent = isOver ? Math.abs(remaining) + ' FM over!' : remaining + ' FM remaining';
                remainingText.className = 'remaining-text ' + (isOver ? 'over' : 'ok');
            }
            
            var teamLimit = maxCost * 3;
            var teamRemaining = teamLimit - teamTotal;
            var teamOver = teamRemaining < 0;
            
            document.getElementById('teamTotal').textContent = teamTotal;
            document.getElementById('teamLimit').textContent = teamLimit;
            document.getElementById('teamRemaining').textContent = teamRemaining;
            document.getElementById('teamRemaining').style.color = teamOver ? '#f44336' : '#4caf50';
            document.getElementById('teamStatus').textContent = teamOver ? 'âœ— OVER' : 'âœ“ OK';
            document.getElementById('teamStatus').style.color = teamOver ? '#f44336' : '#4caf50';
        }

        function updateTier() {
            var tier = parseInt(document.getElementById('tier').value);
            var maxCost = tierLimits[tier];
            document.getElementById('customMax').value = maxCost;
            calculate();
        }

        function resetAll() {
            for (var i = 1; i <= 3; i++) {
                document.getElementById('char' + i + '-name').value = '';
                for (var j = 0; j < fields.length; j++) {
                    document.getElementById('char' + i + '-' + fields[j].key).value = 0;
                }
            }
            calculate();
        }

        function resetCounts() {
            for (var i = 1; i <= 3; i++) {
                for (var j = 0; j < fields.length; j++) {
                    document.getElementById('char' + i + '-' + fields[j].key).value = 0;
                }
            }
            calculate();
        }

        function exportAsImage() {
            var maxCost = parseInt(document.getElementById('customMax').value) || 0;
            var tier = document.getElementById('tier').value;
            var teamTotal = 0;
            var summaryData = [];

            for (var i = 1; i <= 3; i++) {
                var charName = document.getElementById('char' + i + '-name').value || 'Character ' + i;
                var charTotal = 0;
                var charItems = [];

                for (var j = 0; j < fields.length; j++) {
                    var field = fields[j];
                    var count = parseInt(document.getElementById('char' + i + '-' + field.key).value) || 0;
                    if (count > 0) {
                        var cost = count * field.cost;
                        charTotal += cost;
                        charItems.push({
                            label: field.label,
                            count: count,
                            cost: field.cost,
                            total: cost
                        });
                    }
                }

                teamTotal += charTotal;
                summaryData.push({
                    name: charName,
                    total: charTotal,
                    items: charItems,
                    remaining: maxCost - charTotal,
                    isOver: charTotal > maxCost
                });
            }

            var teamLimit = maxCost * 3;
            var teamRemaining = teamLimit - teamTotal;
            var teamOver = teamRemaining < 0;

            var summaryHTML = '<div style="font-family: Arial, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); padding: 30px; min-width: 800px;">' +
                '<div style="background: rgba(30, 30, 50, 0.95); border-radius: 12px; padding: 20px; border: 2px solid rgba(138, 43, 226, 0.5);">' +
                '<h1 style="color: #bb86fc; text-align: center; margin-bottom: 10px; font-size: 28px;">CZN Save Data Summary</h1>' +
                '<p style="color: #999; text-align: center; margin-bottom: 20px; font-size: 14px;">Tier ' + tier + ' - Generated on ' + new Date().toLocaleDateString() + '</p>' +
                '<div style="background: #2a2a40; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444;">' +
                '<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center;">' +
                '<div><div style="color: #aaa; font-size: 12px; margin-bottom: 5px;">Total FM Used</div><div style="color: #bb86fc; font-size: 24px; font-weight: bold;">' + teamTotal + '</div></div>' +
                '<div><div style="color: #aaa; font-size: 12px; margin-bottom: 5px;">FM Limit</div><div style="color: #bb86fc; font-size: 24px; font-weight: bold;">' + teamLimit + '</div></div>' +
                '<div><div style="color: #aaa; font-size: 12px; margin-bottom: 5px;">FM Remaining</div><div style="color: ' + (teamOver ? '#f44336' : '#4caf50') + '; font-size: 24px; font-weight: bold;">' + teamRemaining + '</div></div>' +
                '<div><div style="color: #aaa; font-size: 12px; margin-bottom: 5px;">Team Status</div><div style="color: ' + (teamOver ? '#f44336' : '#4caf50') + '; font-size: 24px; font-weight: bold;">' + (teamOver ? 'âœ— OVER' : 'âœ“ OK') + '</div></div>' +
                '</div></div>';

            for (var k = 0; k < summaryData.length; k++) {
                var char = summaryData[k];
                if (char.items.length === 0) continue;

                summaryHTML += '<div style="background: #2a2a40; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #444;">' +
                    '<div style="border-bottom: 2px solid #bb86fc; padding-bottom: 10px; margin-bottom: 15px;">' +
                    '<h2 style="color: #bb86fc; margin-bottom: 5px; font-size: 20px;">' + char.name + '</h2>' +
                    '<div style="display: flex; justify-content: space-between; align-items: center;">' +
                    '<span style="color: #aaa; font-size: 14px;">FM Usage: <strong style="color: ' + (char.isOver ? '#f44336' : '#4caf50') + ';">' + char.total + ' / ' + maxCost + '</strong></span>' +
                    '<span style="color: ' + (char.isOver ? '#f44336' : '#4caf50') + '; font-size: 14px; font-weight: bold;">' + (char.isOver ? char.remaining + ' FM OVER' : char.remaining + ' FM left') + '</span>' +
                    '</div></div>' +
                    '<div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; color: #e0e0e0; font-size: 13px;">' +
                    '<div style="color: #bb86fc; font-weight: bold;">Card Type</div>' +
                    '<div style="color: #bb86fc; font-weight: bold; text-align: center;">Count</div>' +
                    '<div style="color: #bb86fc; font-weight: bold; text-align: center;">Unit Cost</div>' +
                    '<div style="color: #bb86fc; font-weight: bold; text-align: right;">Total FM</div>';

                for (var m = 0; m < char.items.length; m++) {
                    var item = char.items[m];
                    summaryHTML += '<div>' + item.label + '</div>' +
                        '<div style="text-align: center;">' + item.count + '</div>' +
                        '<div style="text-align: center;">' + item.cost + ' FM</div>' +
                        '<div style="text-align: right; font-weight: bold;">' + item.total + ' FM</div>';
                }

                summaryHTML += '</div></div>';
            }

            summaryHTML += '<div style="margin-top: 20px; padding: 15px; background: rgba(187, 134, 252, 0.1); border-radius: 8px; border: 1px solid #bb86fc; text-align: center; color: #aaa; font-size: 12px;">' +
                'Generated by CZN Save Data Calculator | asmod3ous.github.io/czn' +
                '</div></div></div>';

            var summaryWindow = document.createElement('div');
            summaryWindow.innerHTML = summaryHTML;
            summaryWindow.style.position = 'absolute';
            summaryWindow.style.left = '-9999px';
            document.body.appendChild(summaryWindow);

            html2canvas(summaryWindow, {
                backgroundColor: '#1a1a2e',
                scale: 2,
                logging: false,
                useCORS: true,
                width: 860
            }).then(function(canvas) {
                var link = document.createElement('a');
                var timestamp = new Date().toISOString().slice(0, 10);
                link.download = 'CZN-Team-Tier' + tier + '-' + timestamp + '.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                link.click();
                document.body.removeChild(summaryWindow);
            });
        }

        initTeam();
        calculate();

        var tourSteps = [
            {
                element: '.header',
                title: 'Welcome to CZN Save Data Calculator! ðŸ‘‹',
                text: 'This tool helps you manage Faint Memory (FM) for your 3-character team in Chaos Zero Nightmare. Let\'s take a quick tour!',
                position: 'bottom'
            },
            {
                element: '.controls-row',
                title: 'Set Your Tier Level ðŸŽ¯',
                text: 'Select your current Chaos Manifestation tier (1-10). Each tier has different FM limits. Tier 1 starts at 30 FM, and each tier adds +10 FM.',
                position: 'bottom'
            },
            {
                element: '.team-summary',
                title: 'Team Summary ðŸ“Š',
                text: 'See your entire team\'s FM usage at a glance. The calculator shows total FM used, your limit (3x individual limit), remaining FM, and overall status.',
                position: 'bottom'
            },
            {
                element: '.character-card',
                title: 'Character Cards ðŸŽ®',
                text: 'Each character has their own card. Enter the character name at the top, then input how many of each card type you have. The progress bar shows your FM usage vs. limit.',
                position: 'bottom'
            },
            {
                element: '.inputs-grid',
                title: 'Input Your Cards ðŸ“',
                text: 'Enter the count for each card type. The 3-column layout shows: Card Type | Count | FM Cost. As you type, the calculator updates in real-time!',
                position: 'top'
            },
            {
                element: '.info-section',
                title: 'Quick Reference ðŸ“‹',
                text: 'This section shows all FM costs at a glance. Remember: 1st removal/dupe is FREE (0 FM), and modifiers like Epiphany add extra FM cost.',
                position: 'top'
            },
            {
                element: '.controls-row',
                title: 'Action Buttons ðŸ”§',
                text: 'Reset All clears everything. Reset Counts keeps character names but clears numbers. Export JPG creates a clean summary of your non-zero values!',
                position: 'bottom'
            }
        ];

        var currentStep = 0;

        function startTour() {
            currentStep = 0;
            document.getElementById('tourOverlay').classList.add('active');
            showTourStep(currentStep);
            localStorage.setItem('czn-tour-completed', 'false');
        }

        function showTourStep(step) {
            if (step >= tourSteps.length) {
                endTour();
                return;
            }

            var stepData = tourSteps[step];
            var element = document.querySelector(stepData.element);
            var spotlight = document.getElementById('tourSpotlight');
            var tooltip = document.getElementById('tourTooltip');

            if (!element) {
                nextStep();
                return;
            }

            var rect = element.getBoundingClientRect();
            spotlight.style.top = (rect.top - 10) + 'px';
            spotlight.style.left = (rect.left - 10) + 'px';
            spotlight.style.width = (rect.width + 20) + 'px';
            spotlight.style.height = (rect.height + 20) + 'px';

            var tooltipHTML = '<h3>' + stepData.title + '</h3>' +
                '<p>' + stepData.text + '</p>' +
                '<div class="tour-buttons">' +
                '<button class="tour-btn secondary" onclick="skipTour()">Skip Tour</button>' +
                (step > 0 ? '<button class="tour-btn secondary" onclick="prevStep()">Back</button>' : '') +
                '<button class="tour-btn primary" onclick="nextStep()">' + 
                (step === tourSteps.length - 1 ? 'Finish' : 'Next') + '</button>' +
                '</div>' +
                '<div class="tour-progress">Step ' + (step + 1) + ' of ' + tourSteps.length + '</div>';

            tooltip.innerHTML = tooltipHTML;

            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function nextStep() {
            currentStep++;
            showTourStep(currentStep);
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                showTourStep(currentStep);
            }
        }

        function skipTour() {
            endTour();
        }

        function endTour() {
            document.getElementById('tourOverlay').classList.remove('active');
            localStorage.setItem('czn-tour-completed', 'true');
        }

        if (!localStorage.getItem('czn-tour-completed')) {
            setTimeout(function() {
                startTour();
            }, 1000);
        }
    </script>
</body>
</html>
