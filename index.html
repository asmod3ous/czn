<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CZN Save Data Calculator - Team Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            padding: 8px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .header h1 {
            font-size: 20px;
            color: #bb86fc;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 10px;
            color: #999;
        }

        .controls-row {
            display: grid;
            grid-template-columns: 120px 100px auto;
            gap: 8px;
            margin-bottom: 8px;
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .control-group label {
            display: block;
            font-size: 9px;
            color: #aaa;
            margin-bottom: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 6px;
            background: #2a2a40;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
        }

        .btn-group {
            display: flex;
            gap: 6px;
            align-items: end;
        }

        .btn {
            padding: 6px 12px;
            background: #bb86fc;
            color: #1a1a2e;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn:hover {
            background: #d4b3ff;
            transform: translateY(-1px);
        }

        .btn.secondary {
            background: #6366f1;
        }

        .btn.export {
            background: #10b981;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .character-card {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .char-header {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #444;
        }

        .char-name-input {
            width: 100%;
            padding: 6px;
            background: #1a1a2e;
            border: 2px solid #bb86fc;
            border-radius: 4px;
            color: #bb86fc;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
        }

        .char-budget {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .char-budget-label {
            font-size: 9px;
            color: #aaa;
        }

        .char-budget-value {
            font-size: 14px;
            font-weight: bold;
        }

        .char-budget-value.ok {
            color: #4caf50;
        }

        .char-budget-value.over {
            color: #f44336;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #1a1a2e;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .progress-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .progress-fill.ok {
            background: linear-gradient(90deg, #4caf50 0%, #66bb6a 100%);
        }

        .progress-fill.over {
            background: linear-gradient(90deg, #f44336 0%, #e57373 100%);
        }

        .remaining-text {
            font-size: 9px;
            text-align: right;
            font-weight: 600;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 6px 8px;
            align-items: center;
        }

        .input-label {
            font-size: 10px;
            color: #aaa;
        }

        .input-field {
            width: 60px;
            padding: 5px;
            font-size: 11px;
            text-align: center;
            font-weight: 600;
        }

        .input-cost {
            font-size: 9px;
            color: #888;
            width: 45px;
            text-align: right;
        }

        .team-summary {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            margin-bottom: 8px;
        }

        .summary-title {
            font-size: 12px;
            color: #bb86fc;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .summary-item {
            text-align: center;
            background: #2a2a40;
            padding: 8px;
            border-radius: 4px;
        }

        .summary-label {
            font-size: 9px;
            color: #aaa;
            margin-bottom: 4px;
        }

        .summary-value {
            font-size: 16px;
            font-weight: bold;
            color: #bb86fc;
        }

        .info-section {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 8px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .info-title {
            font-size: 10px;
            color: #bb86fc;
            margin-bottom: 6px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            font-size: 9px;
            color: #aaa;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 2px 4px;
        }

        .info-value {
            color: #bb86fc;
            font-weight: 600;
        }

        @media (max-width: 1200px) {
            .team-grid {
                grid-template-columns: 1fr;
            }
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ CZN Team Save Data Calculator</h1>
            <p>Chaos Zero Nightmare - 3 Character Team Manager</p>
        </div>

        <div class="controls-row">
            <div class="control-group">
                <label>Tier Level</label>
                <select id="tier" onchange="updateTier()">
                    <option value="1">Tier 1 (30 FM)</option>
                    <option value="2">Tier 2 (40 FM)</option>
                    <option value="3">Tier 3 (50 FM)</option>
                    <option value="4">Tier 4 (60 FM)</option>
                    <option value="5">Tier 5 (70 FM)</option>
                    <option value="6">Tier 6 (80 FM)</option>
                    <option value="7">Tier 7 (90 FM)</option>
                    <option value="8">Tier 8 (100 FM)</option>
                    <option value="9">Tier 9 (110 FM)</option>
                    <option value="10">Tier 10 (120 FM)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Custom Max FM</label>
                <input type="number" id="customMax" value="30" min="0" onchange="calculate()">
            </div>

            <div class="btn-group">
                <button class="btn" onclick="resetAll()">Reset All</button>
                <button class="btn secondary" onclick="resetCounts()">Reset Counts</button>
                <button class="btn export" onclick="exportAsImage()">ðŸ“· Export JPG</button>
            </div>
        </div>

        <div class="team-summary">
            <div class="summary-title">ðŸ“Š Team Summary</div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Total FM Used</div>
                    <div class="summary-value" id="teamTotal">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">FM Limit</div>
                    <div class="summary-value" id="teamLimit">90</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">FM Remaining</div>
                    <div class="summary-value" id="teamRemaining">90</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Team Status</div>
                    <div class="summary-value" id="teamStatus">âœ“ OK</div>
                </div>
            </div>
        </div>

        <div class="team-grid" id="teamGrid"></div>

        <div class="info-section">
            <div class="info-title">ðŸ“‹ Faint Memory Costs</div>
            <div class="info-grid">
                <div class="info-item"><span>Neutral:</span><span class="info-value">20 FM</span></div>
                <div class="info-item"><span>Monster:</span><span class="info-value">80 FM</span></div>
                <div class="info-item"><span>Epiphany:</span><span class="info-value">+10 FM</span></div>
                <div class="info-item"><span>Divine Epi:</span><span class="info-value">20 FM</span></div>
                <div class="info-item"><span>Remove 2nd:</span><span class="info-value">10 FM</span></div>
                <div class="info-item"><span>Remove 3rd:</span><span class="info-value">30 FM</span></div>
                <div class="info-item"><span>Remove 4th:</span><span class="info-value">50 FM</span></div>
                <div class="info-item"><span>Remove 5th+:</span><span class="info-value">70 FM</span></div>
                <div class="info-item"><span>Dupe 2nd:</span><span class="info-value">10 FM</span></div>
                <div class="info-item"><span>Dupe 3rd:</span><span class="info-value">30 FM</span></div>
                <div class="info-item"><span>Dupe 4th:</span><span class="info-value">50 FM</span></div>
                <div class="info-item"><span>Dupe 5th+:</span><span class="info-value">70 FM</span></div>
                <div class="info-item"><span>Conversion:</span><span class="info-value">10 FM</span></div>
                <div class="info-item"><span>Forbidden:</span><span class="info-value">20 FM</span></div>
                <div class="info-item"><span>Start Mod:</span><span class="info-value">+20 FM</span></div>
                <div class="info-item"><span>Epi Mod:</span><span class="info-value">+20 FM</span></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        var tierLimits = { 1: 30, 2: 40, 3: 50, 4: 60, 5: 70, 6: 80, 7: 90, 8: 100, 9: 110, 10: 120 };
        
        var fields = [
            { key: 'neutral', label: 'Neutral Cards', cost: 20 },
            { key: 'monster', label: 'Monster Cards', cost: 80 },
            { key: 'epiphany', label: 'Epiphany Modifier', cost: 10 },
            { key: 'divine', label: 'Divine Epiphanies', cost: 20 },
            { key: 'removal2', label: 'Card Removal (2nd)', cost: 10 },
            { key: 'removal3', label: 'Card Removal (3rd)', cost: 30 },
            { key: 'removal4', label: 'Card Removal (4th)', cost: 50 },
            { key: 'removal5', label: 'Card Removal (5th+)', cost: 70 },
            { key: 'dupe2', label: 'Card Duplication (2nd)', cost: 10 },
            { key: 'dupe3', label: 'Card Duplication (3rd)', cost: 30 },
            { key: 'dupe4', label: 'Card Duplication (4th)', cost: 50 },
            { key: 'dupe5', label: 'Card Duplication (5th+)', cost: 70 },
            { key: 'conversion', label: 'Card Conversions', cost: 10 },
            { key: 'forbidden', label: 'Forbidden Cards', cost: 20 },
            { key: 'starting', label: 'Starting Card Modifier', cost: 20 },
            { key: 'epiremoval', label: 'Epiphany Card Modifier', cost: 20 }
        ];

        function initTeam() {
            var grid = document.getElementById('teamGrid');
            grid.innerHTML = '';
            
            for (var i = 1; i <= 3; i++) {
                var card = document.createElement('div');
                card.className = 'character-card';
                
                var html = '<div class="char-header">' +
                    '<input type="text" class="char-name-input" id="char' + i + '-name" placeholder="Character ' + i + ' Name" onchange="calculate()">' +
                    '<div class="char-budget">' +
                    '<span class="char-budget-label">FM Usage</span>' +
                    '<span class="char-budget-value ok" id="char' + i + '-budget">0 / 30</span>' +
                    '</div>' +
                    '<div class="progress-bar">' +
                    '<div class="progress-fill ok" id="char' + i + '-progress" style="width: 0%"></div>' +
                    '</div>' +
                    '<div class="remaining-text ok" id="char' + i + '-remaining">30 FM remaining</div>' +
                    '</div>' +
                    '<div class="inputs-grid">';
                
                for (var j = 0; j < fields.length; j++) {
                    var field = fields[j];
                    html += '<span class="input-label">' + field.label + '</span>' +
                        '<input type="number" class="input-field" id="char' + i + '-' + field.key + '" value="0" min="0" onchange="calculate()">' +
                        '<span class="input-cost">' + field.cost + ' FM</span>';
                }
                
                html += '</div>';
                card.innerHTML = html;
                grid.appendChild(card);
            }
        }

        function calculate() {
            var maxCost = parseInt(document.getElementById('customMax').value) || 0;
            var teamTotal = 0;
            
            for (var i = 1; i <= 3; i++) {
                var charTotal = 0;
                
                for (var j = 0; j < fields.length; j++) {
                    var field = fields[j];
                    var count = parseInt(document.getElementById('char' + i + '-' + field.key).value) || 0;
                    charTotal += count * field.cost;
                }
                
                teamTotal += charTotal;
                
                var remaining = maxCost - charTotal;
                var isOver = remaining < 0;
                var percent = Math.min((charTotal / maxCost) * 100, 100);
                
                document.getElementById('char' + i + '-budget').textContent = charTotal + ' / ' + maxCost;
                document.getElementById('char' + i + '-budget').className = 'char-budget-value ' + (isOver ? 'over' : 'ok');
                
                var progress = document.getElementById('char' + i + '-progress');
                progress.style.width = percent + '%';
                progress.className = 'progress-fill ' + (isOver ? 'over' : 'ok');
                
                var remainingText = document.getElementById('char' + i + '-remaining');
                remainingText.textContent = isOver ? Math.abs(remaining) + ' FM over!' : remaining + ' FM remaining';
                remainingText.className = 'remaining-text ' + (isOver ? 'over' : 'ok');
            }
            
            var teamLimit = maxCost * 3;
            var teamRemaining = teamLimit - teamTotal;
            var teamOver = teamRemaining < 0;
            
            document.getElementById('teamTotal').textContent = teamTotal;
            document.getElementById('teamLimit').textContent = teamLimit;
            document.getElementById('teamRemaining').textContent = teamRemaining;
            document.getElementById('teamRemaining').style.color = teamOver ? '#f44336' : '#4caf50';
            document.getElementById('teamStatus').textContent = teamOver ? 'âœ— OVER' : 'âœ“ OK';
            document.getElementById('teamStatus').style.color = teamOver ? '#f44336' : '#4caf50';
        }

        function updateTier() {
            var tier = parseInt(document.getElementById('tier').value);
            var maxCost = tierLimits[tier];
            document.getElementById('customMax').value = maxCost;
            calculate();
        }

        function resetAll() {
            for (var i = 1; i <= 3; i++) {
                document.getElementById('char' + i + '-name').value = '';
                for (var j = 0; j < fields.length; j++) {
                    document.getElementById('char' + i + '-' + fields[j].key).value = 0;
                }
            }
            calculate();
        }

        function resetCounts() {
            for (var i = 1; i <= 3; i++) {
                for (var j = 0; j < fields.length; j++) {
                    document.getElementById('char' + i + '-' + fields[j].key).value = 0;
                }
            }
            calculate();
        }

        function exportAsImage() {
            var container = document.querySelector('.container');
            
            html2canvas(container, {
                backgroundColor: '#1a1a2e',
                scale: 2,
                logging: false,
                useCORS: true
            }).then(function(canvas) {
                var link = document.createElement('a');
                var timestamp = new Date().toISOString().slice(0, 10);
                var tier = document.getElementById('tier').value;
                link.download = 'CZN-Team-Tier' + tier + '-' + timestamp + '.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                link.click();
            });
        }

        initTeam();
        calculate();
    </script>
</body>
</html>
